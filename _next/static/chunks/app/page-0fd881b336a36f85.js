(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{1853:(e,t,o)=>{"use strict";o.r(t),o.d(t,{api_url:()=>x,default:()=>p});var n=o(5155);o(7904);var s=o(2115);let d=function(e){let{i:t}=e;return(0,n.jsx)("span",{className:"material-symbols-outlined",children:t})},i=function(e){let{todos:t,dispatch:o}=e,i=(0,s.useContext)(x),a=async e=>{e.preventDefault();let n=e.target.todo.value,s=await fetch("".concat(i,"/api/todos"),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:n})});if(s.ok){let e=await s.json();t.some(t=>t.id===e.id)||o({type:"edit",todo:{text:e.text,id:e.id,done:e.done}})}else console.error("failed to add todo");e.target.reset()};return(0,n.jsxs)("form",{className:"form",onSubmit:a,children:[(0,n.jsx)("label",{htmlFor:"todo",children:(0,n.jsx)("input",{type:"text",name:"todo",id:"todo",placeholder:"Попиши мені тута"})}),(0,n.jsxs)("button",{children:[(0,n.jsx)("span",{className:"visually-hidden",children:"Submit"}),(0,n.jsx)(d,{i:"add"})]})]})},a=function(){return(0,n.jsxs)("div",{className:"header",children:[(0,n.jsx)(d,{i:"note_stack"}),(0,n.jsx)("h1",{children:"Сисок зачад"})]})};var l=o(2046);function r(e){let{item:t,dispatch:o}=e,i=(0,s.useContext)(x),[a,l]=(0,s.useState)(!1),r=(0,s.useRef)(null),c=async()=>{(await fetch("".concat(i,"/api/todos"),{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:t.id})})).ok||console.error("error deleting")},u=async()=>{(await fetch("".concat(i,"/api/todos"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...t,done:!t.done})})).ok?o({type:"edit",todo:{...t,done:!t.done}}):console.error("error checking")},h=async()=>{l(!0)};(0,s.useEffect)(()=>{a&&r.current&&(r.current.focus(),r.current.setSelectionRange(r.current.value.length,r.current.value.length))},[a]);let p=async()=>{let e=t.text,n=r.current.value;o({type:"edit",todo:{...t,text:n}}),(await fetch("".concat(i,"/api/todos"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...t,text:n})})).ok||(console.error("error editing"),o({type:"edit",todo:{...t,text:e}}))};return(0,n.jsx)("li",{id:null==t?void 0:t.id,className:"todo_item",children:a?(0,n.jsx)("form",{className:"edit-form",onSubmit:e=>{e.preventDefault(),l(!1),p()},children:(0,n.jsx)("label",{htmlFor:"edit-todo",children:(0,n.jsx)("input",{ref:r,type:"text",name:"edit-todo",id:"edit-todo",defaultValue:null==t?void 0:t.text,onBlur:()=>{l(!1),p()}})})}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("button",{className:"todo_items_left",onClick:u,children:(0,n.jsx)(d,{i:t.done?"check_box":"check_box_outline_blank"})}),(0,n.jsx)("p",{children:t.text}),(0,n.jsxs)("div",{className:"todo_items_right",children:[(0,n.jsxs)("button",{onClick:h,children:[(0,n.jsx)("span",{className:"visually-hidden",children:"Edit"}),(0,n.jsx)(d,{i:"edit"})]}),(0,n.jsxs)("button",{onClick:c,children:[(0,n.jsx)("span",{className:"visually-hidden",children:"Delete"}),(0,n.jsx)(d,{i:"delete"})]})]})]})})}let c=function(e){let{todos:t,dispatch:o,todoStatus:d}=e,i=(0,s.useContext)(x);return(0,s.useEffect)(()=>{let e;return async function(){let e=await fetch("".concat(i,"/api/todos/negotiate"),{method:"POST",credentials:"omit"}).then(e=>e.json()),t=new l.$().withUrl(e.Url,{accessTokenFactory:()=>e.AccessToken,withCredentials:!1}).withAutomaticReconnect().build();t.on("todoUpdated",e=>{o({type:"edit",todo:e})}),t.on("todoDeleted",e=>{o({type:"delete",id:e.id})}),await t.start().catch(console.error)}(),()=>{e&&e.stop()}},[]),(0,n.jsx)("ol",{className:"todo_list",children:t&&t.length>0?null==t?void 0:t.map((e,t)=>(0,n.jsx)(r,{item:e,dispatch:o},t)):(0,n.jsx)("p",{children:-1===d?"Не загрузило :(":0===d?"Якось порожньо":1===d?"Гружусі":2===d?"Мабуть сервак спить":"Помилка чи шо"})})},u=function(e){let{todo_completed:t,todo_total:o}=e;return(0,n.jsxs)("section",{className:"todo_banner",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text_large",children:"Цево"}),(0,n.jsx)("p",{className:"text_small",children:t===o&&0!==o?"Хороший хлопчик":"Давай там"})]}),(0,n.jsxs)("div",{children:[t,"/",o]})]})};o(5704);let h=function(e,t){switch(t.type){case"set":return t.todos;case"edit":var o;if(!e.some(e=>e.id===t.todo.id))return[...e,t.todo];return console.log(null!=(o=t.send)?o:"no send"),e.map(e=>e.id===t.todo.id?t.todo:e);case"delete":return e.filter(e=>e.id!==t.id);default:throw Error("Unexpected action: "+t.type)}};function p(){let[e,t]=(0,s.useReducer)(h,[]),[o,d]=(0,s.useState)(1),l=(0,s.useContext)(x);return(0,s.useEffect)(()=>{try{fetch("".concat(l,"/api/todos")).then(e=>e.text()).then(e=>JSON.parse(e)).then(e=>t({type:"set",todos:e})),d(0)}catch(e){console.error(e),d(-1)}},[]),(0,n.jsxs)("div",{className:"App",children:[(0,n.jsx)(a,{}),(0,n.jsx)(u,{todo_completed:e.filter(e=>e.done).length,todo_total:e.length}),(0,n.jsx)(i,{todos:e,dispatch:t}),(0,n.jsx)(c,{todos:e,dispatch:t,todoStatus:o})]})}let x=(0,s.createContext)("https://anturated-cnepggaggjegayfp.polandcentral-01.azurewebsites.net")},6173:(e,t,o)=>{Promise.resolve().then(o.bind(o,1853))},7904:()=>{}},e=>{e.O(0,[415,46,441,255,358],()=>e(e.s=6173)),_N_E=e.O()}]);